# 菜系和套餐管理功能

## 概述

为管理后台添加了菜系和套餐管理功能，管理员可以通过后台界面添加、编辑和删除餐厅的菜系分类和套餐选项。

## 功能特性

### 菜系管理

- ✅ 查看所有菜系列表（卡片式展示）
- ✅ 添加新菜系（名称、描述、图片）
- ✅ 编辑现有菜系
- ✅ 删除菜系（带保护机制，有套餐关联时不可删除）
- ✅ 支持图片 URL 配置

### 套餐管理

- ✅ 查看所有套餐列表
- ✅ 添加新套餐（名称、描述、价格、人数、用餐类型、所属菜系）
- ✅ 编辑现有套餐
- ✅ 删除套餐（带保护机制，已被预订时不可删除）
- ✅ 支持早餐、午餐、晚餐三种用餐类型
- ✅ 套餐可关联菜系分类
- ✅ 显示套餐价格、最大人数等信息

## 文件结构

### 后端文件

#### 1. 控制器

**文件**: `server/src/controllers/adminRestaurantController.js`

包含以下功能：

- `createCuisine` - 创建菜系
- `updateCuisine` - 更新菜系
- `deleteCuisine` - 删除菜系（带关联检查）
- `createMealPackage` - 创建套餐
- `updateMealPackage` - 更新套餐
- `deleteMealPackage` - 删除套餐（带关联检查）

#### 2. 路由

**文件**: `server/src/routes/adminRoutes.js`

新增路由：

```javascript
// 菜系管理
POST   /api/admin/cuisines      - 创建菜系
PUT    /api/admin/cuisines/:id  - 更新菜系
DELETE /api/admin/cuisines/:id  - 删除菜系

// 套餐管理
POST   /api/admin/packages      - 创建套餐
PUT    /api/admin/packages/:id  - 更新套餐
DELETE /api/admin/packages/:id  - 删除套餐
```

所有路由都需要管理员权限认证。

### 前端文件

#### 1. 管理页面

**文件**: `src/views/admin/MenuManagement.vue`

功能：

- 双标签页界面（菜系管理 / 套餐管理）
- 菜系卡片式展示，支持图片预览
- 套餐列表式展示，带用餐类型标签
- 模态框表单用于添加/编辑
- 删除确认提示

#### 2. 路由配置

**文件**: `src/router/index.ts`

新增路由：

```typescript
{
  path: 'menu',
  name: 'admin-menu',
  component: () => import('../views/admin/MenuManagement.vue'),
}
```

#### 3. 导航菜单

**文件**: `src/views/admin/AdminDashboard.vue`

在管理后台侧边栏添加了"菜单管理"导航项。

## 使用指南

### 访问管理页面

1. 登录管理后台
2. 点击侧边栏的"菜单管理"
3. 选择"菜系管理"或"套餐管理"标签页

### 添加菜系

1. 进入"菜系管理"标签页
2. 点击"添加菜系"按钮
3. 填写菜系信息：
   - 菜系名称（必填）
   - 菜系描述（可选）
   - 图片 URL（可选）
4. 点击"保存"

### 添加套餐

1. 进入"套餐管理"标签页
2. 点击"添加套餐"按钮
3. 填写套餐信息：
   - 套餐名称（必填）
   - 套餐描述（可选）
   - 价格（必填，元/人）
   - 最大人数（必填）
   - 用餐类型（必填：早餐/午餐/晚餐）
   - 所属菜系（可选）
4. 点击"保存"

### 编辑和删除

- 点击每个项目的"编辑"按钮可修改信息
- 点击"删除"按钮可删除项目
- 删除时会检查关联关系，防止误删

## 数据验证

### 菜系

- 名称：必填
- 描述：可选
- 图片 URL：可选

### 套餐

- 名称：必填
- 描述：可选
- 价格：必填，数字类型，≥0
- 最大人数：必填，整数，≥1
- 用餐类型：必填，只能是 breakfast/lunch/dinner
- 所属菜系：可选，必须是已存在的菜系 ID

## 安全特性

### 权限控制

- 所有管理 API 都需要管理员权限
- 使用 JWT Token 认证
- 前端路由守卫保护

### 数据保护

- 删除菜系前检查是否有套餐关联
- 删除套餐前检查是否有预订使用
- 防止误删导致数据不一致

### 输入验证

- 后端验证所有必填字段
- 验证数据类型和格式
- 验证用餐类型枚举值

## 界面特点

### 菜系管理

- 响应式网格布局
- 卡片式展示，支持图片
- 悬停效果增强交互
- 空状态显示占位图标

### 套餐管理

- 列表式布局，信息密度高
- 用餐类型彩色标签（早餐-黄色、午餐-蓝色、晚餐-紫色）
- 显示价格、人数、菜系等关键信息
- 图标辅助信息展示

### 表单设计

- 模态框弹出，不离开当前页面
- 必填项标记清晰
- 实时验证反馈
- 保存状态提示

## API 响应格式

### 成功响应

```json
{
  "success": true,
  "data": { ... },
  "message": "操作成功"
}
```

### 错误响应

```json
{
  "success": false,
  "error": {
    "message": "错误信息"
  }
}
```

## 注意事项

1. **图片上传**：当前版本使用图片 URL，建议配合上传功能使用
2. **删除保护**：有关联数据时无法删除，需先处理关联
3. **价格格式**：支持小数点后两位，单位为元
4. **用餐类型**：必须与时间段配置的类型一致

## 后续优化建议

1. 添加图片上传功能，替代手动输入 URL
2. 支持批量操作（批量删除、批量导入）
3. 添加套餐排序功能
4. 支持套餐启用/禁用状态
5. 添加数据统计（各菜系套餐数量、预订量等）
6. 支持套餐复制功能
7. 添加搜索和筛选功能
