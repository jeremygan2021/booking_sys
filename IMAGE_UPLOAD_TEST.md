# 图片上传功能测试指南

## 测试前准备

1. 确保后端服务器正在运行
2. 确保前端开发服务器正在运行
3. 使用管理员账号登录系统

## 测试步骤

### 1. 测试图片上传

1. 登录管理后台
2. 进入"内容管理"页面
3. 点击"图片管理"标签
4. 点击"上传图片"按钮
5. 选择一张或多张图片（支持中文文件名）
6. 等待上传完成
7. 验证：
   - 图片应该正确显示在图片列表中
   - 文件名应该正确显示（包括中文字符）
   - 可以点击"复制链接"按钮复制图片URL

### 2. 测试房间类型图片绑定

1. 在"内容管理"页面，点击"房间内容"标签
2. 点击任意一个房间类型进行编辑
3. 在"房间图片"部分，点击"选择图片"按钮
4. 从图片库中选择一张或多张图片
5. 点击"确认选择"
6. 点击"保存"按钮
7. 验证：
   - 选中的图片应该显示在编辑窗口中
   - 可以点击图片上的删除按钮移除图片
   - 保存后，前往"房间预订"页面查看房间展示
   - 房间卡片应该正确显示绑定的图片

### 3. 测试菜系封面图片绑定

1. 在"内容管理"页面，点击"餐厅内容"标签
2. 在"菜系管理"部分，点击"添加菜系"或编辑现有菜系
3. 填写菜系名称和描述
4. 在"菜系封面"部分，点击"选择封面图片"按钮
5. 从图片库中选择一张图片
6. 点击"确认选择"
7. 点击"保存"或"添加"按钮
8. 验证：
   - 选中的图片应该显示在编辑窗口中
   - 可以点击图片上的删除按钮移除图片
   - 保存后，在菜系列表中应该显示封面图片
   - 前往"菜单管理"页面，菜系卡片应该显示封面图片

### 4. 测试图片删除

1. 在"图片管理"页面
2. 单张删除：
   - 鼠标悬停在图片上
   - 点击删除图标
   - 确认删除
   - 验证图片已从列表中移除
3. 批量删除：
   - 点击选择多张图片
   - 点击"删除选中"按钮
   - 确认删除
   - 验证所有选中的图片已从列表中移除

### 5. 测试前端图片显示

1. 房间展示：
   - 访问房间预订页面
   - 验证房间卡片显示正确的图片
   - 图片应该清晰，无乱码
   - 点击房间卡片查看详情，图片应该正确显示

2. 餐厅展示：
   - 访问餐厅预订页面
   - 验证餐厅图片轮播正常工作
   - 图片应该清晰，无乱码

3. 菜系展示：
   - 在菜单管理页面
   - 验证菜系卡片显示正确的封面图片
   - 图片应该清晰，无乱码

## 常见问题排查

### 问题1：图片上传后显示乱码

**原因**：文件名包含中文字符，编码处理不正确

**解决方案**：

- 已在 `uploadController.js` 中修复
- 使用 `Buffer.from(file.originalname, 'latin1').toString('utf8')` 正确处理中文文件名

### 问题2：图片无法显示

**可能原因**：

1. 图片路径不正确
2. API基础URL配置错误
3. CORS问题

**排查步骤**：

1. 检查浏览器控制台是否有404错误
2. 检查 `.env` 文件中的 `VITE_API_BASE_URL` 配置
3. 检查图片URL是否正确拼接（应该是 `http://localhost:3000/uploads/文件名`）
4. 检查后端 `app.js` 中的静态文件服务配置

### 问题3：图片选择器无法打开

**可能原因**：

1. 图片列表加载失败
2. 权限问题

**排查步骤**：

1. 检查浏览器控制台是否有API错误
2. 确认已使用管理员账号登录
3. 检查 `auth_token` 是否正确存储在 localStorage 中

### 问题4：保存后图片未绑定

**可能原因**：

1. API请求失败
2. 数据格式不正确

**排查步骤**：

1. 检查浏览器控制台的网络请求
2. 确认请求体中包含正确的图片路径
3. 检查后端日志是否有错误

## 测试数据

### 测试图片建议

1. 准备以下类型的图片进行测试：
   - 中文文件名的图片（如：房间照片.jpg）
   - 英文文件名的图片（如：room-photo.jpg）
   - 不同格式的图片（JPG, PNG, GIF, WEBP）
   - 不同大小的图片（小于5MB）

### 测试房间类型

- 豪华套房
- 标准间
- 家庭房

### 测试菜系

- 法式料理
- 中式料理
- 意式料理

## 预期结果

所有测试步骤应该顺利完成，没有错误。图片应该：

- 正确上传到服务器
- 正确显示在管理后台
- 正确绑定到房间、餐厅和菜系
- 正确显示在前端页面
- 支持中文文件名，无乱码
